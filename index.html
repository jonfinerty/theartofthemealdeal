<!DOCTYPE html>
<html>
  <head>
    <title>Meal Deal Optimizer</title>
    <style>
      .oswald-200 {
        font-family: "Oswald", serif;
        font-optical-sizing: auto;
        font-weight: 200;
        font-style: normal;
      }
      body {
        font-family: "Oswald", serif;
        font-optical-sizing: auto;
        font-weight: 200;
        font-style: normal;
        max-width: 800px;
        margin: 20px auto;
        padding: 0 20px;
        transition: opacity 1s ease-in-out;
      }
      div {
        text-align: center;
      }
      h1 {
        font-family: "Oswald", serif;
        font-weight: 200;

        font-size: 6em;
        text-align: center;
      }
      .controls {
        margin-bottom: 20px;
      }
      .result {
        /* background: #f5f5f5; */
        padding: 15px;
        border-radius: 4px;
        margin-top: 20px;
      }
      button {
        padding: 8px 16px;
        margin: 0 5px;
        cursor: pointer;
      }
      .active {
        background: #007bff;
        color: white;
        border: none;
      }
      .sentence {
        font-size: 1.2em;
        margin: 20px 0;
      }
      .inline-select {
        font-family: "Oswald", serif;
        font-size: 2em;
        display: inline;
        width: auto;
        padding: 2px 5px;
        border: none;
        border-bottom: 2px solid #333;
        background: transparent;
        cursor: pointer;
      }
      .inline-select:focus {
        outline: none;
        border-bottom-color: #666;
      }
      img {
        filter: grayscale(0.5);
        width: 160px;
        height: auto;
      }
      #result {
        transition: opacity 0.3s ease-in-out;
        color: #444;
      }
      .fade {
        opacity: 0;
      }
      #meal-details {
        max-width: 600px;
        margin: 0 auto;
      }

      .meal-detail-row {
        display: flex;
        gap: 1rem;
      }

      .meal-label {
        min-width: 160px;
        text-align: right;
      }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap"
      rel="stylesheet"
    />
    <script src="mains.js"></script>
    <script src="sides.js"></script>
    <script src="drinks.js"></script>
  </head>
  <body>
    <div class="container">
      <h1>The Art of the Meal Deal</h1>

      <div class="sentence">
        <select id="property" class="inline-select">
          <option value="cals" data-mode="max">Highest Calorie Meal Deal</option>
          <option value="cals" data-mode="min">Lowest Calorie Meal Deal</option>
          <option value="price" data-mode="max">Best Savings Meal Deal</option>
          <option value="price" data-mode="min">Worst Savings Meal Deal</option>
          <option value="weight" data-mode="max">Heaviest Meal Deal</option>
          <option value="weight" data-mode="min">Lightest Meal Deal</option>
        </select>
      </div>

      <div id="result">
        <div
          class="meal-display"
          style="
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 120px;
            margin-bottom: 80px;
          "
        >
          <div class="meal-item" title="">
            <img id="main-img" src="" alt="" />
          </div>
          <div class="meal-item" title="">
            <img id="side-img" src="" alt="" />
          </div>
          <div class="meal-item" title="">
            <img id="drink-img" src="" alt="" />
          </div>
        </div>
        <div id="meal-details">
          <p class="meal-detail-row">
            <strong class="meal-label">Main:</strong>
            <span id="main-name"></span>
          </p>
          <p class="meal-detail-row">
            <strong class="meal-label">Side:</strong>
            <span id="side-name"></span>
          </p>
          <p class="meal-detail-row">
            <strong class="meal-label">Drink:</strong>
            <span id="drink-name"></span>
          </p>
          <p class="meal-detail-row">
            <strong class="meal-label"
              ><span id="property-label"></span>:</strong
            >
            <span id="total-value"></span>
          </p>
        </div>
      </div>
    </div>

    <script>
      function updateItem(type, item) {
        const imgElement = document.getElementById(`${type}-img`);
        const nameElement = document.getElementById(`${type}-name`);
        const itemContainer = document.querySelector(
          `.meal-item img[id="${type}-img"]`
        ).parentElement;

        imgElement.src = item.img_url;
        imgElement.alt = item.name;
        itemContainer.title = item.name;

        imgElement.onload = () => {
          imgElement.classList.remove("fade");
        };

        // Update text
        nameElement.textContent = item.name;
      }

      function setMain(main) {
        updateItem("main", main);
      }

      function setSide(side) {
        updateItem("side", side);
      }

      function setDrink(drink) {
        updateItem("drink", drink);
      }

      function findOptimalMeal() {
        select = document.getElementById("property");
        const property = select.value;
        const mode = select.options[select.selectedIndex].dataset.mode;

        // Find optimal combination
        let optimalMeal = null;
        let optimalValue = mode === "max" ? -Infinity : Infinity;

        mains.forEach((main) => {
          sides.forEach((side) => {
            drinks.forEach((drink) => {
              if (
                main[property] === null ||
                side[property] === null ||
                drink[property] === null
              ) {
                return;
              }
              const totalValue =
                main[property] + side[property] + drink[property];

              if (mode === "max" && totalValue > optimalValue) {
                optimalValue = totalValue;
                optimalMeal = { main, side, drink, total: totalValue };
              } else if (mode === "min" && totalValue < optimalValue) {
                optimalValue = totalValue;
                optimalMeal = { main, side, drink, total: totalValue };
              }
            });
          });
        });

        let label =""
        if (property === "cals") {
            label = "Calories";
            value = `${optimalMeal.total.toFixed(0)}kcal`
          } else if (property === "price") {
             label = "Price";
            value = `Â£${optimalMeal.total.toFixed(2)}`
        } else if (property === "weight") {
             label = "Weight";
             value = `${optimalMeal.total.toFixed(0)}g`
            }

        const resultsElement = document.getElementById("result");
        resultsElement.classList.add("fade");
        setTimeout(() => {
          setMain(optimalMeal.main);
          setSide(optimalMeal.side);
          setDrink(optimalMeal.drink);

          document.getElementById("property-label").textContent = label;
          document.getElementById("total-value").textContent = value;

          resultsElement.classList.remove("fade");
        }, 300);
      }

      function mealDealRoulette() {
        const property = document.getElementById("property").value;

        // Randomly select one item from each category
        const randomMain = mains[Math.floor(Math.random() * mains.length)];
        const randomSide = sides[Math.floor(Math.random() * sides.length)];
        const randomDrink = drinks[Math.floor(Math.random() * drinks.length)];

        const randomMeal = {
          main: randomMain,
          side: randomSide,
          drink: randomDrink,
        };

        // Display result
        const propertyLabel =
          document.getElementById("property").options[
            document.getElementById("property").selectedIndex
          ].text;
        document.getElementById("result").innerHTML = `
                <div class="meal-item">
                    <img src="${randomMeal.main.img_url}" alt="${randomMeal.main.name}" style="width: 100px; height: auto;">
                    <p><strong>Main:</strong> ${randomMeal.main.name}</p>
                </div>
                <div class="meal-item">
                    <img src="${randomMeal.side.img_url}" alt="${randomMeal.side.name}" style="width: 100px; height: auto;">
                    <p><strong>Side:</strong> ${randomMeal.side.name}</p>
                </div>
                <div class="meal-item">
                    <img src="${randomMeal.drink.img_url}" alt="${randomMeal.drink.name}" style="width: 100px; height: auto;">
                    <p><strong>Drink:</strong> ${randomMeal.drink.name}</p>
                </div>
            `;
      }

      // Add event listeners
      document
        .getElementById("property")
        .addEventListener("change", findOptimalMeal);

      // document.getElementById('randomiseButton').addEventListener('click', mealDealRoulette);

      // Initial calculation
      findOptimalMeal();
    </script>
  </body>
</html>
